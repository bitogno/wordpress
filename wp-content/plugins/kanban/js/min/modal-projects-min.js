function Modal_Projects(r){$(document).trigger("/modal-projects/init/",r),this.$el=r,this.dom()}Modal_Projects.prototype.board=function(){return boards[current_board_id]},Modal_Projects.prototype.dom=function(){var r=this;r.$el.on("show.bs.modal",function(){if(!r.board().current_user().has_cap("write"))return!1;r.board().project_update_counts();var e=$("#accordion-projects").empty(),t=r.board().record.status_records();for(var o in r.board().record.project_records){var a=r.board().record.project_records[o],n=kanban.templates[r.board().record.id()]["t-modal-project"].render({project:a,statuses:t});$(n).appendTo(e)}}),r.$el.on("click",".btn-project-delete",function(){var e=confirm(kanban.text.project_delete_confirm);if(e!==!0)return!1;var t=$(this),o=t.closest(".panel"),a=t.attr("data-id"),n=r.board().record.project_records[a],c={project:n,action:"delete_project",kanban_nonce:$("#kanban_nonce").val()};$.ajax({method:"POST",url:kanban.ajaxurl,data:c}).done(function(e){for(var t in r.board().record.tasks){var n=r.board().record.tasks[t];n.record.project_id==a&&n.project_save(0)}delete r.board().record.project_records[a],o.remove()})}),r.$el.on("focus",".project-title",function(){var r=$(this);r.data("orig",r.val())}),r.$el.on("keyup",".project-title",function(r){var e=$(this);if(13==r.keyCode)return e.trigger("blur"),!1;if(27==r.keyCode){var t=e.data("orig");return e.val(t).trigger("blur"),!1}}),r.$el.on("blur",".project-title",function(){var e=$(this),t=e.closest(".panel"),o=e.val(),a=e.attr("data-id"),n=r.board().record.project_records[a];n.title=o;var c={project:n,action:"save_project",kanban_nonce:$("#kanban_nonce").val()};$.ajax({method:"POST",url:kanban.ajaxurl,data:c}).done(function(e){$(".label-project-title",t).text(o);for(var n in r.board().record.tasks){var c=r.board().record.tasks[n];c.record.project_id==a&&c.project_save(a)}})}),r.$el.on("click",".btn-project-reset",function(){var r=$(this),e=r.closest(".panel-project"),t=$(".select-project-reset",e),o=e.attr("data-id"),a=t.val();if(""==a||""==o)return!1;var n={action:"reset_project",project_id:o,status_id:a,kanban_nonce:$("#kanban_nonce").val()};return $.ajax({method:"POST",url:kanban.ajaxurl,data:n}).done(function(r){kanban.updates_task()}),!1}),r.$el.on("click","#modal-project-new-btn",function(){var r=$("#modal-project-new-input").val();return""!=r&&(Project.prototype.add(Board.prototype.get_current_board_id(),r,function(){$("#modal-project-new-input").val(""),$("#modal-projects").modal("hide")}),!1)})};